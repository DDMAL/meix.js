<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>MEI Editor Demo Page</title>

        <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
        <link rel="stylesheet" href="/diva.js/build/css/diva.min.css" />
        <link rel="stylesheet" href="/meiEditor.css" />

        <!--foreign libraries -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js" ></script>
        <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
        <script src="FileSaver.js"></script> <!-- Thanks to http://eligrey.com/demos/FileSaver.js/FileSaver.js -->
        <script src="https://x2js.googlecode.com/hg/xml2json.js"></script>

        <!--local libraries -->
        <script src="/diva.js/build/js/diva.js" type="text/javascript"></script>
        <script src="/diva.js/build/js/utils.js" type="text/javascript"></script>
        <script src="/diva.js/build/js/plugins/highlight.js" type="text/javascript"></script>
        <script src="/ace/src/ace.js" type="text/javascript" charset="utf-8"></script>

        <!--project-specific code -->
        <script src="meiEditor.js"></script>
        <script src="meilint.js"></script>
        <script src="meiEditorFileUpload.js"></script>
        <script src="meiEditorXMLValidator.js"></script>
        <script src="meiEditorDivaManager.js"></script>
        <script>
        /*
            Function to be called on resizing. Not leaving this anonymous so that it can be called at the beginning without triggering the Diva .resize() listener.
        */
        var resizeComponents = function()
        {
            topbarHeight = $("#topbar").height();
            $("#topbar").css({
                'left': '0.2%',
                'width': '49.6%' 
            });
            $("#mei-editor").css({
                'height': $(window).height() - topbarHeight - 7, //7 for padding
            });
            $("#mei-editor").offset({
                'top': topbarHeight,
                'left': '0.2%',
            });
            $("#diva-wrapper").offset({
                'left': $(window).width / 2 - 10,
            })
        }

        $(function() 
        {
            jsonFile = 'imagesOut.json';
            //create the diva wrapper and editor
            $('#diva-wrapper').diva(
            {
                contained: true,
                enableAutoHeight: true,
                enableAutoWidth: true,
                fixedHeightGrid: false,
                iipServerURL: "http://132.206.14.136:8000/fcgi-bin/iipsrv.fcgi",
                objectData: jsonFile,
                imageDir: "/opt/stgall",
                enableHighlight: true,
                viewerWidthPadding: 0,
                viewerHeightPadding: 0,
            });

            divaInstance = $('#diva-wrapper').data('diva');
            meiEditor = $("#mei-editor").AceMeiEditor([new meiEditorFileUpload, new meiEditorXMLValidator, new meiEditorDivaManager], {'divaInstance': divaInstance, 'jsonFileLocation': jsonFile});

            //little graphics things
            $(window).on('resize', resizeComponents);

            resizeComponents();

        });

        </script>
    </head>
    <body>

        <div id="mei-editor"></div>
        <div id="diva-wrapper"></div>
    </body>
</html> 